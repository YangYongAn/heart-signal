<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Heart Signal</title>
  <link rel="icon" type="image/svg+xml" href="./favicon.svg">
  <style>
    @font-face {
      font-family: 'LED';
      src: url('./led.ttf') format('truetype');
    }

    @font-face {
      font-family: 'GenSenRounded';
      src: url('https://img.yangyongan.com/heart-signal/GenSenRounded-M.ttc') format('truetype');
      font-weight: normal;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0a0a0a;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .bottom-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      border-top: 1px solid #222;
      gap: 20px;
      flex-shrink: 0;
    }

    .status-group {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .online-count {
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.1);
      font-size: 0.85rem;
    }

    .shortcuts {
      display: flex;
      gap: 20px;
      padding: 0;
      background: transparent;
      border: none;
    }

    .shortcut {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: #888;
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .shortcut-emoji {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      image-rendering: crisp-edges;
    }

    .shortcut kbd {
      background: #222;
      padding: 3px 8px;
      border-radius: 4px;
      border: 1px solid #444;
      font-family: monospace;
      color: #fff;
      font-size: 0.75rem;
    }

    .connection-status {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
    }

    .connection-status.connected {
      background: rgba(46, 213, 115, 0.2);
      color: #2ed573;
    }

    .connection-status.disconnected {
      background: rgba(255, 71, 87, 0.2);
      color: #ff4757;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      flex: 1;
      padding: 12px 20px;
      gap: 12px;
      min-height: 0;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: 30px;
      flex-shrink: 0;
      min-height: 180px;
      position: relative;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .title {
      font-size: clamp(2.5rem, 4vw, 5rem);
      font-weight: bold;
      color: #ff4757;
      text-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
      white-space: nowrap;
    }

    .mode-display {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    #current-mode {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #current-mode img {
      width: 150px;
      height: 150px;
      image-rendering: crisp-edges;
    }

    .bpm-display {
      display: flex;
      align-items: baseline;
      gap: 12px;
      margin-left: auto;
    }

    .bpm-value {
      font-family: 'LED', monospace;
      font-size: clamp(5rem, 10vw, 10rem);
      font-weight: normal;
      color: #ff4757;
      line-height: 1;
      letter-spacing: 2px;
    }

    .bpm-label {
      font-size: 1.2rem;
      color: #666;
    }

    .ecg-container {
      width: 100%;
      flex: 1;
      border: 2px solid #333;
      border-radius: 10px;
      background: #111;
      position: relative;
      overflow: hidden;
      min-height: 0;
    }

    #ecg-canvas {
      width: 100%;
      height: 100%;
    }

    .lyrics-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .lyrics-container.show {
      opacity: 1;
    }

    .lyrics-line {
      font-family: 'GenSenRounded', -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', sans-serif;
      font-size: clamp(5rem, 12vw, 12rem);
      font-weight: bold;
      text-align: center;
      white-space: nowrap;
      letter-spacing: 0.15em;
    }

    /* å¡æ‹‰OKæ•ˆæœ - æ¯ä¸ªå­—çš„å®¹å™¨ */
    .lyrics-line .char {
      display: inline-block;
      position: relative;
    }

    /* åº•å±‚ - é»˜è®¤ç™½è‰² */
    .lyrics-line .char .char-bg {
      color: #ffffff;
      text-shadow:
        3px 3px 6px rgba(0, 0, 0, 0.8),
        -1px -1px 0 rgba(0, 0, 0, 0.3),
        1px -1px 0 rgba(0, 0, 0, 0.3),
        -1px 1px 0 rgba(0, 0, 0, 0.3),
        1px 1px 0 rgba(0, 0, 0, 0.3);
    }

    /* ä¸Šå±‚ - è“è‰²+å¤–æè¾¹ï¼ˆå¡æ‹‰OKé«˜äº®ï¼‰ */
    .lyrics-line .char .char-fg {
      position: absolute;
      left: 0;
      top: 0;
      color: #00bfff;
      text-shadow:
        /* ç™½è‰²å¤–æè¾¹ï¼ˆå¤šä¸ªæ–¹å‘æ¨¡æ‹Ÿæè¾¹ï¼‰ */
        -2px -2px 0 #ffffff,
        2px -2px 0 #ffffff,
        -2px 2px 0 #ffffff,
        2px 2px 0 #ffffff,
        -2px 0 0 #ffffff,
        2px 0 0 #ffffff,
        0 -2px 0 #ffffff,
        0 2px 0 #ffffff,
        /* é»‘è‰²é˜´å½±å¢å¼ºå¯¹æ¯” */
        4px 4px 8px rgba(0, 0, 0, 0.8);
      clip-path: inset(0 100% 0 0);
    }

    /* äºŒç»´ç åŒºåŸŸ */
    .qr-section {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 16px;
    }

    .qr-text {
      font-size: clamp(1.8rem, 3vw, 2.5rem);
      font-weight: bold;
      color: #999;
      white-space: nowrap;
    }

    .youspace-logo {
      position: absolute;
      width: 32px;
      height: 32px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 4px;
      border-radius: 50%;
    }

    .qr-code-wrapper {
      position: relative;
      display: inline-block;
    }

    .qr-code {
      width: 150px;
      height: 150px;
      border: 3px solid #fff;
      border-radius: 8px;
      background: #fff;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <div class="qr-section">
          <div class="qr-code-wrapper">
            <img id="qr-code" class="qr-code" alt="æ‰«ç äº’åŠ¨">
            <svg class="youspace-logo" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M336.996771 425.149048l44.017472 44.031694a62.257345 62.257345 0 1 0 88.020722-88.063389l-44.010361-44.017472c-48.618329-48.618329-48.618329-127.472893-0.014222-176.105443 48.62544-48.62544 127.444448-48.62544 176.055666 0 0 0 27.477143 27.498476 44.017472 44.031694a62.236012 62.236012 0 0 0 88.020722 0c24.319831-24.305609 24.305609-63.736446 0-88.049167l-44.017472-44.017472c-97.222436-97.272213-254.860452-97.272213-352.089999 0-52.600524 52.593413-76.68569 122.893369-72.376386 191.74978-68.820855-4.316414-139.092367 19.775863-191.700003 72.390608-97.222436 97.257991-97.222436 254.945785 0 352.210888l44.017473 44.017472a62.22179 62.22179 0 0 0 88.020722 0c24.31272-24.305609 24.31272-63.743557 0-88.034944l-44.010361-44.038806c-48.604107-48.639662-48.611218-127.472893 0-176.105443 48.611218-48.632551 127.444448-48.632551 176.048555 0" fill="#FF3A3A"/><path d="M950.866286 335.777224c-97.080215-97.11577-254.455122-97.101548-351.542448 0-97.065993 97.11577-97.065993 254.540455 0.014222 351.649113 48.525885 48.547218 48.525885 127.280894-0.014222 175.828113-48.532996 48.547218-127.238228 48.547218-175.757002 0-48.540107-48.540107-48.540107-127.273783 0-175.828113l43.946362-43.946361c24.24872-24.284276 24.24872-63.644002 0-87.921167a62.157791 62.157791 0 0 0-87.892723 0l-43.946362 43.960583c-97.080215 97.094437-97.080215 254.540455 0 351.649114 97.080215 97.101548 254.469344 97.101548 351.542448-0.007111 97.065993-97.101548 97.080215-254.547566 0-351.642003-48.525885-48.554329-48.540107-127.280894 0-175.81389 48.532996-48.568552 127.238228-48.561441 175.778335 0 48.525885 48.532996 48.525885 127.259561-0.021333 175.81389l-43.939251 43.960584c-24.255832 24.262943-24.255832 63.62978 0.014222 87.899834a62.122235 62.122235 0 0 0 87.878501 0l43.939251-43.946362c97.080215-97.11577 97.080215-254.540455 0-351.656224" fill="#FF3A3A"/></svg>
          </div>
        </div>
        <div class="title-group">
          <h1 class="title" id="title">Heart Signal</h1>
          <span class="qr-text" id="qr-text">ğŸ‘ˆğŸ» å‹ç©ºé—´æ‰«ç äº’åŠ¨</span>
          <span class="countdown-text" id="countdown-text" style="display: none; color: rgba(255, 255, 255, 0.7); font-size: 2rem; font-family: 'LED', monospace; letter-spacing: 0.05em;"></span>
        </div>
      </div>
      <div class="mode-display">
        <span id="current-mode"></span>
      </div>
      <div class="bpm-display">
        <div class="bpm-value" id="bpm-value">72</div>
        <div class="bpm-label">BPM</div>
      </div>
    </div>

    <div class="ecg-container">
      <canvas id="ecg-canvas"></canvas>
      <div id="danmaku-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; will-change: transform; transform: translateZ(0); backface-visibility: hidden;"></div>
      <div class="lyrics-container" id="lyrics-container">
        <div class="lyrics-line" id="lyrics-line"></div>
      </div>
    </div>
  </div>

  <div class="bottom-bar">
    <div class="shortcuts">
      <div class="shortcut">
        <kbd>Enter</kbd>
        <img src="https://koishi.js.org/QFace/assets/qq_emoji/312/apng/312.png" alt="æ¿€åŠ¨" class="shortcut-emoji">
        <span>æ¿€åŠ¨</span>
      </div>
      <div class="shortcut">
        <kbd>Backspace</kbd>
        <img src="https://koishi.js.org/QFace/assets/qq_emoji/284/apng/284.png" alt="æ­»äº¡" class="shortcut-emoji">
        <span>æ­»äº¡</span>
      </div>
      <div class="shortcut">
        <kbd>Space</kbd>
        <img src="https://koishi.js.org/QFace/assets/qq_emoji/332/apng/332.png" alt="éŸ³ä¹" class="shortcut-emoji">
        <span>éŸ³ä¹</span>
      </div>
      <div class="shortcut">
        <kbd>Tab</kbd>
        <img src="https://koishi.js.org/QFace/assets/qq_emoji/8/apng/8.png" alt="æ­£å¸¸" class="shortcut-emoji">
        <span>æ­£å¸¸</span>
      </div>
      <div class="shortcut">
        <kbd>F</kbd>
        <span>å…¨å±</span>
      </div>
    </div>

    <div class="status-group">
      <div class="online-count" id="online-count">
        Online: 0
      </div>
      <div class="connection-status disconnected" id="connection-status">
        Disconnected
      </div>
    </div>
  </div>

  <script>
    // ç”ŸæˆäºŒç»´ç å¹¶æ§åˆ¶æ˜¾ç¤ºæ—¶é—´
    (function() {
      const qrImg = document.getElementById('qr-code');
      const mobileUrl = `${window.location.protocol}//${window.location.host}/mobile`;
      const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&ecc=H&data=${encodeURIComponent(mobileUrl)}`;
      qrImg.src = qrApiUrl;

      // æ—¶é—´æ§åˆ¶ï¼š2026å¹´02æœˆ03æ—¥ 18:00 ä¹‹å‰éšè—äºŒç»´ç å’Œå¼•å¯¼æ–‡æ¡ˆ
      const showTime = new Date('2026-02-03T18:00:00').getTime();

      const qrSection = document.querySelector('.qr-section');
      const qrText = document.getElementById('qr-text');
      const countdownText = document.getElementById('countdown-text');
      let intervalId = null;

      function pad(num) {
        return num < 10 ? '0' + num : String(num);
      }

      function updateDisplay() {
        const now = new Date().getTime();
        const diff = showTime - now;

        if (diff <= 0) {
          // æ—¶é—´åˆ°äº†ï¼Œæ˜¾ç¤ºäºŒç»´ç å’Œå¼•å¯¼æ–‡æ¡ˆ
          if (qrSection) qrSection.style.display = 'flex';
          if (qrText) qrText.style.display = 'inline';
          if (countdownText) countdownText.style.display = 'none';
          if (intervalId) {
            clearInterval(intervalId);
            intervalId = null;
          }
        } else {
          // è¿˜æ²¡åˆ°æ—¶é—´ï¼Œéšè—äºŒç»´ç ï¼Œæ˜¾ç¤ºå€’è®¡æ—¶
          if (qrSection) qrSection.style.display = 'none';
          if (qrText) qrText.style.display = 'none';
          if (countdownText) {
            countdownText.style.display = 'inline';

            // è®¡ç®—å‰©ä½™æ—¶é—´
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            // æ ¼å¼åŒ–æ˜¾ç¤º
            let countdownStr = 'è·ç¦»å¼€å§‹è¿˜æœ‰ ';
            if (days > 0) {
              countdownStr += days + 'å¤© ';
            }
            countdownStr += pad(hours) + ':' + pad(minutes) + ':' + pad(seconds);

            countdownText.textContent = countdownStr;
          }
        }
      }

      // åˆå§‹æ˜¾ç¤º
      updateDisplay();

      // å¦‚æœè¿˜æ²¡åˆ°æ—¶é—´ï¼Œå¼€å§‹å€’è®¡æ—¶
      if (new Date().getTime() < showTime) {
        intervalId = setInterval(updateDisplay, 1000);
      }
    })();
  </script>
  <script type="module" src="../src/client/app.ts"></script>
</body>
</html>
